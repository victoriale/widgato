var gameloop=function(e){},player,playerClickCooldown=0,platforms,topPlatforms,botPlatforms,playerDieing=!1,clouds,skylines,pigeons,score=0,highscore=0,skyline1,skyline2,sky,cursorOverPauseButton=!1,playerHasClickedYet=!1,emitter,uiHeart1,scoreText,uiHeart2,uiHeart3,uiBackground,interfaceBackground,pauseBackground,pauseButton,playButton,featherIcon,help,clickToLiftButton,pigeonKillCount=0,pigeonHighKillCount=0,pigeonScoreText,pigeonsTillNextHeart=20,lives=3,obstacleCooldown=100;gameloop.prototype={init:function(e,t){highscore=e?e:0,pigeonHighKillCount=t?t:0},create:function(){console.log("%cGame Loop Started.","color:white; background:red"),obstacleCooldown=100,sky=game.add.sprite(0,0,"sky"),clouds=game.add.group(),skylines=game.add.group(),platforms=game.add.group(),topPlatforms=game.add.group(),botPlatforms=game.add.group(),pigeons=game.add.group(),platforms.enableBody=!0,topPlatforms.enableBody=!0,botPlatforms.enableBody=!0,pigeons.enableBody=!0,clouds.enableBody=!0,skylines.enableBody=!0,skyline1=skylines.create(0,game.world.height-100,"sky-parralax"),skyline1.anchor.x=.5,skyline1.anchor.y=.5,skyline2=skylines.create(game.world.width,game.world.height-100,"sky-parralax"),skyline2.anchor.x=.5,skyline2.anchor.y=.5,this.createPlayer(),this.createInitialObstacles(),uiBackground=game.add.sprite(0,0,"ui-bg"),uiHeart1=game.add.sprite(5,5,"icon-heart"),uiHeart1.scale.setTo(.65,.65),uiHeart2=game.add.sprite(30,5,"icon-heart"),uiHeart2.scale.setTo(.65,.65),uiHeart3=game.add.sprite(55,5,"icon-heart"),uiHeart3.scale.setTo(.65,.65),help=game.add.sprite(150,30,"help"),help.anchor.setTo(.5,.5),help.scale.setTo(.8,.8),scoreText=game.add.text(game.world.width/2,16,score,{font:"bold 20px Lato",fill:"#44ad26"}),scoreText.anchor.setTo(.5,.5),this.setScore(0),featherIcon=game.add.sprite(game.world.width-10,3,"icon-feather"),featherIcon.scale.setTo(.65,.65),pigeonScoreText=game.add.text(game.world.width-18,16,pigeonKillCount,{font:"bold 20px Lato",fill:"#3879ba"}),pigeonScoreText.anchor.setTo(1,.5),interfaceBackground=game.add.sprite(0,game.world.height-50,"ui-bg"),interfaceBackground.scale.setTo(1,2),clickToLiftButton=game.add.button(5,game.world.height-45,"lift-button",this.clickToLiftButtonAction,this),pauseBackground=game.add.sprite(game.world.width/2,game.world.height/2,"ui-bg"),pauseBackground.anchor.setTo(.5,.5),pauseBackground.scale.setTo(1,15),pauseBackground.alpha=.5,pauseBackground.visible=!1,pauseButton=game.add.button(game.world.width-45,game.world.height-45,"pause-button",this.clickToPauseButtonAction,this),pauseButton.events.onInputOver.add(this.overPause,this),pauseButton.events.onInputOut.add(this.offPause,this),playButton=game.add.button(game.world.width-45,game.world.height-45,"play-button",this.clickToPauseButtonAction,this),playButton.events.onInputOver.add(this.overPause,this),playButton.events.onInputOut.add(this.offPause,this),playButton.visible=!1,pausedIcon=game.add.sprite(game.world.width/2,game.world.height/2,"paused"),pausedIcon.anchor.setTo(.5,.5),pausedIcon.visible=!1,this.resetGameState()},update:function(){game.physics.arcade.overlap(player,pigeons,this.collectpigeon,null,this),game.physics.arcade.overlap(player,topPlatforms,this.playerDeath,null,this),game.physics.arcade.overlap(player,botPlatforms,this.playerDeath,null,this),(player.body.position.y>=game.canvas.height-50||player.body.position.y<=20)&&this.playerDeath(player),this.registerInput(),this.checkObstacles(),this.checkpigeons(),this.checkClouds(),this.checkSkylines()},render:function(){},registerInput:function(){game.input.activePointer.isDown&&0>=playerClickCooldown&&playerDieing===!1&&cursorOverPauseButton===!1&&(playerHasClickedYet===!1&&(playerHasClickedYet=!0,player.body.moves=!0,player.body.gravity.y=600),player.body.velocity.y=-300,playerClickCooldown=18,player.animations.play("increase-height")),player.body.velocity.y>=0&&playerDieing===!1&&"normal"!==player.animations.name&&player.animations.play("normal"),playerClickCooldown>0&&(playerClickCooldown-=1)},resetGameState:function(){topPlatforms.forEachAlive(function(e){e.kill()}),botPlatforms.forEachAlive(function(e){e.kill()}),pigeons.forEachAlive(function(e){e.kill()}),clouds.forEachAlive(function(e){e.kill()}),skylines.forEachAlive(function(e){e.kill()}),pigeonKillCount=0,pigeonScoreText.text=pigeonKillCount,lives=3,playerClickCooldown=0,cursorOverPauseButton=!1,playerHasClickedYet=!1,playerDieing=!1,pigeonsTillNextHeart=20,obstacleCooldown=0,this.setScore(0),this.revivePlayer()},overPause:function(){cursorOverPauseButton=!0},offPause:function(){cursorOverPauseButton=!1},clickToLiftButtonAction:function(){},clickToPauseButtonAction:function(){game.paused===!0?(playButton.visible=!1,pauseButton.visible=!0,pauseBackground.visible=!1,game.paused=!1,pausedIcon.visible=!1):(pauseButton.visible=!1,playButton.visible=!0,pauseBackground.visible=!0,game.paused=!0,cursorOverPauseButton=!1,pausedIcon.visible=!0)},createCloud:function(e){cloud=clouds.create(game.world.width+100,game.rnd.integerInRange(0,game.world.height-150),"cloud"),cloud.anchor.x=.5,cloud.anchor.y=.5,cloud.body.gravity.y=0,cloud.body.gravity.x=game.rnd.integerInRange(-2,-10);var t=game.rnd.realInRange(.3,.9);cloud.scale.setTo(t,t)},checkClouds:function(){clouds.forEach(function(e){e.alive===!0&&e.body.position.x<-200&&e.reset(game.world.width+100,game.rnd.integerInRange(0,game.world.height))},this),clouds.countLiving()<8&&1===game.rnd.integerInRange(1,300)&&this.createCloud()},addScore:function(e){score+=e,score>highscore&&(highscore=score),scoreText.text=score},setScore:function(e){score=e,scoreText.text=score},playerDeathAnimationDone:function(e,t){var o;0===lives?this.game.state.start("GameOver",!1,!1,score,highscore,pigeonKillCount,pigeonHighKillCount):(topPlatforms.forEach(function(e){e.kill()},this),botPlatforms.forEach(function(e){e.kill()},this),lives--,2===lives&&(uiHeart3.kill(),uiHeart3=game.add.sprite(55,5,"icon-heart-empty"),uiHeart3.scale.setTo(.65,.65),o=55),1===lives&&(uiHeart2.kill(),uiHeart2=game.add.sprite(30,5,"icon-heart-empty"),uiHeart2.scale.setTo(.65,.65),o=30),0===lives&&(uiHeart1.kill(),uiHeart1=game.add.sprite(5,5,"icon-heart-empty"),uiHeart1.scale.setTo(.65,.65),o=5),emitter=game.add.emitter(o,5,1),emitter.makeParticles("icon-heart"),emitter.maxParticleScale=.65,emitter.minParticleScale=.65,emitter.minParticleAlpha=.7,emitter.maxParticleAlpha=.7,emitter.start(!0,6e3,null,1),playerDieing=!1,this.revivePlayer())},createPlayer:function(){player=game.add.sprite(20,215,"player"),player.animations.add("normal",[2],10,!0),player.animations.add("increase-height",[1,0],10,!1);var e=player.animations.add("death",[3,4,5],10,!0);e.onComplete.add(this.playerDeathAnimationDone,this),player.animations.play("normal"),player.scale.setTo(.35,.35),game.physics.arcade.enable(player),player.body.setSize(100,25,10,35),playerHasClickedYet=!1,player.body.bounce.y=0,player.body.collideWorldBounds=!0},iglooEvent:function(e){try{var t=e.event;t.event="widget-interaction";var o={snt_data:t,action:"snt_tracker"};this.sendPostMessageToIgloo(o,5)}catch(i){console.log("Not currently hosted inside igloo... disabling analytics")}},sendPostMessageToIgloo:function(e,t){var o=[window],i=window,a=0;t="undefined"==typeof t?10:t;try{for(;a++<t&&i!==window.top;)i=i.parent,o.push(i)}catch(l){}for(var n=0;n<o.length;n++)o[n].postMessage(e,"*")},revivePlayer:function(){this.iglooEvent(query),playerHasClickedYet=!1,player.reset(20,215)},playerDeath:function(e){e.body.moves=!1,playerDieing=!0,e.animations.play("death",10,!1,!1)},createInitialObstacles:function(){var e=botPlatforms.create(game.world.width,0,"obstacle-bottom-1");e.width=70,e.height=195,e.body.immovable=!0,e.ltype="bottom",e.kill(),e=botPlatforms.create(game.world.width,0,"obstacle-bottom-2"),e.body.setSize(130,300,0,55),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="bottom",e.kill(),e=botPlatforms.create(game.world.width,0,"obstacle-bottom-3"),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="bottom",e.kill(),e=botPlatforms.create(game.world.width,0,"obstacle-bottom-4"),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="bottom",e.kill(),e=botPlatforms.create(game.world.width,0,"obstacle-bottom-5"),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="bottom",e.kill();e=topPlatforms.create(game.world.width,0,"obstacle-top-1"),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="top",e.kill(),e=topPlatforms.create(game.world.width,0,"obstacle-top-2"),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="top",e.kill(),e=topPlatforms.create(game.world.width,0,"obstacle-top-3"),e.body.setSize(130,350,0,0),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="top",e.kill(),e=topPlatforms.create(game.world.width,0,"obstacle-top-4"),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="top",e.kill(),e=topPlatforms.create(game.world.width,0,"obstacle-top-5"),e.width=70,e.height=195,e.body.immovable=!0,e.ltype="top",e.kill()},spawnObstacles:function(){obstacleCooldown=100;var e=game.rnd.integerInRange(165,175),t=game.rnd.integerInRange(0,100),o=35;topPlatforms.countLiving()+botPlatforms.countLiving()<2&&(t=20),topLedge=this.getRandomTop(),topLedge&&topLedge.reset(game.world.width,game.world.height/2-e/2-t-90-40),botLedge=this.getRandomBot(),botLedge&&botLedge.reset(game.world.width,game.world.height/2+e/2-t+o-40)},getRandomTop:function(){for(var e=topPlatforms.getRandom(0,4);e.alive===!0;)e=topPlatforms.getRandom(0,4);return e},getRandomBot:function(){for(var e=botPlatforms.getRandom(0,4);e.alive===!0;)e=botPlatforms.getRandom(0,4);return e},checkObstacles:function(){topPlatforms.forEachAlive(function(e){e.body.position.x-=2,e.body.position.x<-1*e.width&&(e.kill(),this.addScore(5))},this),botPlatforms.forEachAlive(function(e){e.body.position.x-=2,e.body.position.x<-1*e.width&&(e.kill(),this.addScore(5))},this),botPlatforms.countLiving()+topPlatforms.countLiving()<4&&0>=obstacleCooldown&&this.spawnObstacles(),obstacleCooldown>0&&(obstacleCooldown-=1)},checkSkylines:function(){skyline1.x-=1,skyline2.x-=1,skyline1.x<skyline1.width/2*-1&&skyline1.reset(game.world.width+skyline1.width/2,game.world.height-100),skyline2.x<skyline2.width/2*-1&&skyline2.reset(game.world.width+skyline2.width/2,game.world.height-100)},createpigeons:function(e){for(var t=0;e>t;t++){var o=pigeons.create(300,game.rnd.integerInRange(50,game.world.width),"pigeon");o.checkWorldBounds=!0,o.events.onOutOfBounds.add(this.pigeonOutOfBounds,this),o.isExploding=!1,o.scale.setTo(.35,.35),o.body.setSize(75,75,25,25),o.body.gravity.y=300,o.body.velocity.y=-150,o.body.velocity.x=game.rnd.integerInRange(-100,-50),o.animations.add("fly",[0,1,2],10,!0);var i=o.animations.add("explode",[3,4,5],10,!1);i.onComplete.add(this.pigeonDeathComplete,this),o.animations.play("fly")}},pigeonOutOfBounds:function(e){e.kill(),e.position.x=320},checkpigeons:function(){if(pigeons.forEachAlive(function(e){if(e.isExploding===!1){e.body.position.x-=2;var t=game.rnd.integerInRange(1,25);1===t&&(e.body.velocity.y=-150)}},this),1===game.rnd.integerInRange(1,75))if(pigeons.countDead()+pigeons.countLiving()<6)this.createpigeons(1);else{var e=pigeons.getFirstDead();e&&(e.reset(300,game.rnd.integerInRange(50,200)),e.body.moves=!0,e.body.gravity.y=300,e.body.velocity.y=-150,e.body.velocity.x=game.rnd.integerInRange(-100,-50),e.animations.play("fly"))}},collectpigeon:function(e,t){t.isExploding===!1&&(t.isExploding=!0,t.body.moves=!1,t.animations.play("explode",15,!1,!1),emitter=game.add.emitter(t.centerX,t.centerY,5),emitter.makeParticles("icon-feather"),emitter.maxParticleScale=.3,emitter.minParticleScale=.2,emitter.start(!0,8e3,null,5))},pigeonDeathComplete:function(e,t){pigeonKillCount++,pigeonsTillNextHeart--,pigeonKillCount>pigeonHighKillCount&&(pigeonHighKillCount=pigeonKillCount),pigeonScoreText.text=pigeonKillCount,e.kill(),e.body.moves=!0,e.isExploding=!1,e.position.x=320,this.addScore(10),0===pigeonsTillNextHeart&&(pigeonsTillNextHeart=20,3>lives&&(2===lives&&(uiHeart3.kill(),uiHeart3=game.add.sprite(55,5,"icon-heart"),uiHeart3.scale.setTo(.65,.65)),1===lives&&(uiHeart2.kill(),uiHeart2=game.add.sprite(30,5,"icon-heart"),uiHeart2.scale.setTo(.65,.65)),0===lives&&(uiHeart1.kill(),uiHeart1=game.add.sprite(5,5,"icon-heart"),uiHeart1.scale.setTo(.65,.65)),lives++))}};
